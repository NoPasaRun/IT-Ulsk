{% extends "base.html" %}
<!DOCTYPE html>
<html lang="en">
<head>
    {% block custom_styles %}
        <link rel="stylesheet" href="/static/styles/dashboard/dashboard.css">
        <link rel="stylesheet" href="/static/styles/dashboard/dashboard-media.css">
    {% endblock %}
    <title>{% block title %}Дашборды{% endblock %}</title>
</head>
<body>
    {% block main %}
    {% set gap = 5 %}
        <main class="main">
            <h1 class="section__heading section__heading_big">Дашборды</h1>
            <section class="circles">
                <div class="wrapper">
                    <h3 class="section__heading">Аналитика IT-компаний Ульяновской области</h3>
                    <div class="diagram__block">
                        <div class="diagram">
                            <strong class="diagram__title">Технологии IT-компаний</strong>
                            <p class="diagram__decription">
                                Отображены 5 самых популярных технологий, используемых в 
                                IT-компаниях Ульяновской области.
                            </p>
                            <div class="circle__data">
                                <div class="circle__diagram">
                                    {% set angle = namespace(value=0) %}
                                    {% for value in tech_dist.data.values() %}
                                        {% set procent = value / tech_dist.total * 100 %}
                                        <div class="circle__part" 
                                        style="--procent: {{ procent - gap / tech_dist.amount }}%; --angle: {{ angle.value }}deg; --opacity: {{ (loop.index + 1) / tech_dist.amount}}; --color: #2C46CF;">
                                        </div>
                                        {% set angle.value = angle.value + procent * 3.6 %}
                                    {% endfor %}
                                </div>
                                <ul class="diagram__list">
                                    {% for title, value in tech_dist.data.items() %}
                                        {% set procent = (value / tech_dist.total * 100)|round %}
                                        <li class="diagram__item" style="--opacity: {{ (loop.index + 1) / tech_dist.amount}}; --color: #2C46CF;">{{ title }} ({{ procent }}%)</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                        <div class="diagram">
                            <strong class="diagram__title">Услуги IT-компаний</strong>
                            <p class="diagram__decription">
                                Отображены 5 самых популярных услуг, используемых в 
                                IT-компаниях Ульяновской области.
                            </p>
                            <div class="circle__data">
                                <div class="circle__diagram">
                                    {% set angle = namespace(value=0) %}
                                    {% for value in offer_dist.data.values() %}
                                        {% set procent = value / offer_dist.total * 100 %}
                                        <div class="circle__part"
                                        style="--procent: {{ procent - gap / offer_dist.amount }}%; --angle: {{ angle.value }}deg; --opacity: {{ (loop.index + 1) / offer_dist.amount}}; --color: #654AAD;">
                                        </div>
                                        {% set angle.value = angle.value + procent * 3.6 %}
                                    {% endfor %}
                                </div>
                                <ul class="diagram__list">
                                    {% for title, value in offer_dist.data.items() %}
                                        {% set procent = (value / offer_dist.total * 100)|round %}
                                        <li class="diagram__item" style="--opacity: {{ (loop.index + 1) / offer_dist.amount}}; --color: #654AAD;">{{ title }} ({{ procent }}%)</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="histogram">
                <div class="wrapper">
                    <h3 class="section__heading">Аналитика рейтингов компаний</h3>
                    <div class="diagram__block">
                        <div class="diagram">
                            <strong class="diagram__title">Топ-10 компаний</strong>
                            <p class="diagram__decription">
                                На гистограмме отображены топ-10 компаний по оборотам за 2024 год.
                            </p>
                            <div class="histogram__wrapper">
                                <ul class="values__wrapper">
                                    {% for label in hist_y %}
                                        <li class="values__label">{{ label }}</li>
                                    {% endfor %}
                                </ul>
                                <ul class="column__wrapper">
                                    {% for label in hist_x %}
                                        <li class="histogram__column" style="--height: {{ label.procent * 100}}%; --opacity: {{ label.procent * 5 }}; --color: #2C46CF;"></li>
                                    {% endfor %}
                                </ul>
                                <div class="list__wrapper">
                                    <ul class="diagram__list">
                                        {% for label in hist_x %}
                                            {% if loop.index < 6 %}
                                                <li class="diagram__item diagram__item_fixed-width" style="--opacity: {{ label.procent * 5 }}; --color: #2C46CF;">{{ label.title }}</li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                    <ul class="diagram__list">
                                        {% for label in hist_x %}
                                            {% if loop.index > 5 %}
                                                <li class="diagram__item diagram__item_fixed-width" style="--opacity: {{ label.procent * 5 }}; --color: #2C46CF;">{{ label.title }}</li>
                                            {% endif %}                                    
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="circles">
                <h1 class="section__heading section__heading_big">Аналитика посетителей</h1>
                <div class="wrapper">
                    <div class="diagram__block">
                        <div class="diagram">
                            <strong class="diagram__title">Распределение по странам</strong>
                            <p class="diagram__decription">
                                Пользователи таких стран нас уже посетили.
                            </p>
                            <div class="circle__data">
                                <div class="circle__diagram">
                                    {% set angle = namespace(value=0) %}
                                    {% for value in country_data.data.values() %}
                                        {% set procent = value / country_data.total * 100 %}
                                        <div class="circle__part" 
                                        style="--procent: {{ procent - gap / 5 }}%; --angle: {{ angle.value }}deg; --opacity: {{ (loop.index + 1) / 5}}; --color: #2C46CF;">
                                        </div>
                                        {% set angle.value = angle.value + procent * 3.6 %}
                                    {% endfor %}
                                </div>
                                <ul class="diagram__list">
                                    {% for title, value in country_data.data.items() %}
                                        {% set procent = (value / country_data.total * 100)|round %}
                                        <li class="diagram__item" style="--opacity: {{ (loop.index + 1) / country_data.amount}}; --color: #2C46CF;">{{ title }} ({{ procent }}%)</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                        <div class="diagram">
                            <strong class="diagram__title">Часто посещаемые страницы</strong>
                            <p class="diagram__decription">
                                Самыми интересными страницами считают:
                            </p>
                            <div class="circle__data">
                                <div class="circle__diagram">
                                    {% set angle = namespace(value=0) %}
                                    {% for value in page_data.data.values() %}
                                        {% set procent = value / page_data.total * 100 %}
                                        <div class="circle__part"
                                        style="--procent: {{ procent - gap / page_data.amount }}%; --angle: {{ angle.value }}deg; --opacity: {{ (loop.index + 1) / page_data.amount}}; --color: #654AAD;">
                                        </div>
                                        {% set angle.value = angle.value + procent * 3.6 %}
                                    {% endfor %}
                                </div>
                                <ul class="diagram__list">
                                    {% for title, value in page_data.data.items() %}
                                        {% set procent = (value / page_data.total * 100)|round %}
                                        <li class="diagram__item" style="--opacity: {{ (loop.index + 1) / page_data.amount}}; --color: #654AAD;">{{ title }} ({{ procent }}%)</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    {% endblock %}
</body>
</html>